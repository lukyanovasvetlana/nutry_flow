# Задача: Создание архитектуры фронтенда (Flutter приложения)

## Назначение

Определить техническую архитектуру фронтенда мобильного Flutter-приложения. Включает выбор паттернов, структуру кода, стратегию компонентов, планирование state management (BLoC), описание API-интеграций (Supabase, Firebase), настройку тестирования и деплоя, с учётом best practices Flutter и шаблона `front-end-architecture-tmpl`.

## Входные данные

- Product Requirements Document (PRD) (`prd-tmpl` или аналог)
- Готовая UI/UX-спецификация (`front-end-spec-tmpl` или аналог)
- Основной архитектурный документ (`architecture` или аналог) — особенно структура системы (монорепозиторий/полирепозиторий, архитектура бэкенда)
- Основные дизайн-файлы (Figma, Sketch и др., ссылка из UI/UX-спеки)

## Ключевые шаги и инструкции

### 1. Подтверждение режима взаимодействия

- Спроси пользователя: "Как будем создавать архитектуру фронтенда? A. Инкрементально (по секциям, с ревью каждого шага) — рекомендуется для сложных решений. B. YOLO (сразу драфт всего, потом итерации) — быстрее, но менее детально."
- Дождись выбора пользователя и подтверди режим.

### 2. Анализ входных данных и контекста

- Внимательно изучи входные данные, включая UI/UX-спеку и архитектуру (особенно "Definitive Tech Stack Selections", API-контракты, структуру системы).
- Задай уточняющие вопросы для устранения разрывов между UI/UX и архитектурой.

### 3. Определение философии и паттернов фронтенда (для `front-end-architecture`)

- На основе архитектуры и структуры системы:
  - Выбери фреймворк (Flutter), основные библиотеки (BLoC, Supabase, Firebase, Material 3).
  - Определи стратегию компонентной архитектуры (feature-based, atomic design, widgets).
  - Определи стратегию state management (BLoC, Cubit, Provider — если релевантно).
  - Принципы data flow.
  - Подход к стилям (Material 3, кастомные темы).
  - Ключевые паттерны (например, DI через GetIt, разделение presentation/data/domain).

### 4. Структура директорий фронтенда

- Совместно определи структуру директорий, чтобы она соответствовала Flutter best practices и обеспечивала модульность и масштабируемость (feature-based, разделение core/utils/widgets/features и т.д.).

### 5. Стратегия компонентов и конвенции

- Определи правила именования и организации компонентов (widgets).
- Зафиксируй шаблон описания компонента (по `front-end-architecture`), подчеркни, что большинство компонентов будут детализироваться по мере развития, но должны следовать этому шаблону.
- При необходимости определи несколько базовых/shared UI-компонентов (например, Button, Modal, если не используется готовая библиотека).

### 6. Настройка state management

- Детализируй выбранное решение (BLoC/Cubit):
  - Структура хранилища (feature-based blocs/cubits)
  - Глобальные/ядровые блоки (например, auth/session)
  - Конвенции для событий, состояний, шаблоны

### 7. Слой API-интеграций

- Определи подход к работе с HTTP (например, Dio, http).
- Определи паттерны для сервисов (инкапсуляция API-запросов, репозитории).
- Описать обработку ошибок, retry-стратегии, работу с Supabase/Firebase.

### 8. Стратегия роутинга

- Подтверди библиотеку роутинга (например, GoRouter).
- Совместно определи основные маршруты и guard'ы.

### 9. Сборка, бандлинг и деплой

- Опиши процесс сборки и скрипты (Flutter build, flavor'ы).
- Документируй оптимизации бандлинга.
- Подтверди детали деплоя (например, App Store, Google Play, Firebase Hosting для web).

### 10. Стратегия тестирования фронтенда

- Детализируй стратегию тестирования: unit-тесты (test/), widget-тесты, интеграционные тесты, инструменты (flutter_test, integration_test, CI/CD).

### 11. Производительность

- Перечисли ключевые стратегии оптимизации производительности (lazy loading, image caching, оптимизация build(), минимизация rebuilds, DevTools).

### 12. Документирование и подтверждение (по `front-end-architecture-tmpl`)

- **Инкрементальный режим:**
  - Для каждой секции:
    - **a. Объясни цель и покажи драфт секции.**
    - **b. Обсуди и доработай по фидбеку.**
    - **c. предлагай [Расширенные опции саморефлексии и элицитации](#расширенные-опции-саморефлексии-и-элицитации)**
    - **d. Получи явное одобрение секции, проверь placeholder-ссылки.**
  - После одобрения всех секций — подтверди, что документ готов для шагов 13 (Epic/Story Impacts) и 14 (чек-лист).
- **YOLO-режим:**
  - Заполни все секции шаблона, создай драфт.
  - Покажи полный драфт пользователю для ревью.
  - <important_note>После показа полного драфта предложи condensed-меню расширенных опций для общего ревью (например, выравнивание с требованиями, оценка рисков).</important_note>
  - Получи явное одобрение всего документа перед шагами 13 и 14.

### 13. Влияние на эпики и stories (фокус на фронтенд)

- После подтверждения архитектуры проверь её влияние на существующие эпики и stories.
- Определи, какие технические задачи нужно добавить (например, "Реализовать адаптивную верстку экрана X", "Настроить BLoC для профиля", "Создать reusable компонент Y").
- Проверь, нужно ли доработать acceptance criteria в существующих stories (например, уточнить взаимодействия, компоненты, требования к производительности).
- Совместно с пользователем зафиксируй все изменения или явно укажи, что изменений не требуется.

### 14. Чек-лист и финализация

- После заполнения и ревью архитектуры, а также фиксации влияния на эпики/stories — используй `frontend-architecture-checklist`.
- Пройди по каждому пункту чек-листа, чтобы убедиться, что архитектура полная и все секции проработаны.
- Для каждой секции зафиксируй статус ([x] Выполнено, [N/A], [!] Требует доработки).
- Если есть пробелы — обсуди их с пользователем, доработай документ.
- После доработки покажи summary ревью по чек-листу: что покрыто, что N/A (с пояснением), какие важные решения/изменения были внесены.
- Цель — сделать архитектуру фронтенда полным и actionable документом.

## Расширенные опции саморефлексии и элицитации

(Этот раздел вызывается по необходимости)

Предложи пользователю следующий список "Расширенных действий для саморефлексии, элицитации и брейншторминга". Объясни, что это опциональные шаги для повышения качества, поиска альтернатив и глубокой проработки секции. Пользователь может выбрать действие по номеру или пропустить и двигаться дальше.

"Для повышения качества секции: **[Название секции]** и её надёжности, рассмотрения альтернатив и разных углов зрения, я могу выполнить одно из следующих действий. Выберите номер (8 — чтобы завершить секцию и двигаться дальше):

**Расширенные действия для саморефлексии, элицитации и брейншторминга:**

1. **Критический самоанализ и выравнивание с целями пользователя**
2. **Генерация и оценка альтернативных решений**
3. **Стресс-тест пользовательских сценариев и взаимодействий (концептуально)**
4. **Глубокий разбор предположений и ограничений**
5. **Аудит usability и accessibility, уточняющие вопросы**
6. **Совместный брейншторминг UI-фич**
7. **Выявление "непредвиденных пользовательских потребностей" и будущих вопросов по взаимодействию**
8. **Завершить секцию и двигаться дальше**

После выполнения выбранного действия обсудим результат и решим, нужны ли доработки секции."

ПОВТОРЯЙ, пока пользователь не выберет 8 или не попросит перейти к следующей секции.
